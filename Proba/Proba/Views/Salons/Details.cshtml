@model Proba.Models.DetailsReservationViewModel

@{
    ViewBag.Title = "Details";
}

@*
    DETAILS SALON
*@

<div>
    <img class="slika-profil" src="~/UserImages/@Model.Salon.ImagePath" style="max-width:250px !important" />

    <h1 class="header-profil">

        <b class="naslov-profil">
            @Html.DisplayFor(model => model.Salon.Name)

        </b>

    </h1>

    <br />
    <br />
</div>

<div class="form-horizontal info-profil">

    <div style=" padding-top:5%; padding-left:20% ">

        <div class="form-group">
            <div class="col-md-2">
                @Html.LabelFor(model => model.Salon.Address)
            </div>
            <div class="col-md-6">
                @Html.Label(Model.Salon.Address)
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-2">
                @Html.LabelFor(model => model.Salon.City)
            </div>
            <div class="col-md-6">
                @Html.Label(Model.Salon.City)
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-2">
                @Html.LabelFor(model => model.Salon.Rating)
            </div>
            <div class="col-md-6">
                <p>@string.Format("{0:n2}", Model.Salon.Rating)</p>
            </div>
        </div>

        @if (User.IsInRole("Client"))
        {
            <div class="form-group tagg">
                <div class="col-md-2">
                    <p><b>Оцени го салонот</b></p>
                </div>
                <div id="toVote" class="col-md-6" style="display:none">
                    <img src="~/UploadedFiles/stars/1024px-Empty_Star.svg.png" alt="Star Rating" align="middle" id="1" class="rating max-width-25-px" />
                    <img src="~/UploadedFiles/stars/1024px-Empty_Star.svg.png" alt="Star Rating" align="middle" id="2" class="rating max-width-25-px" />
                    <img src="~/UploadedFiles/stars/1024px-Empty_Star.svg.png" alt="Star Rating" align="middle" id="3" class="rating max-width-25-px" />
                    <img src="~/UploadedFiles/stars/1024px-Empty_Star.svg.png" alt="Star Rating" align="middle" id="4" class="rating max-width-25-px" />
                    <img src="~/UploadedFiles/stars/1024px-Empty_Star.svg.png" alt="Star Rating" align="middle" id="5" class="rating max-width-25-px" />
                    <div class="result"></div>
                </div>
                <div id="voted" style="display:none">
                    @{
                        int red = ViewBag.votes;
                        for (int i = 0; i < red; i++)
                        {
                            <img src="~/UploadedFiles/stars/589px-Star_empty.svg.png" alt="Star Rating" align="middle" class="max-width-25-px" />
                        }
                        for (int i = 5; i > red; i--)
                        {
                            <img src="~/UploadedFiles/stars/1024px-Empty_Star.svg.png" alt="Star Rating" align="middle" class="max-width-25-px" />
                        }

                    }
                </div>
            </div>
        }
        <table class="form-group">
            <thead>
                <tr class="col-md-2">
                    <td>@Html.LabelFor(model => model.Salon.Services)</td>
                </tr>
            </thead>
            <tbody>
                @{

                    List<String> images = new List<String>();
                    int index = 0;
                    bool flag = false;
                }
                @foreach (var service in Model.Salon.Services)
                {
                    <tr>
                        <td style="padding:15px 15px">
                            @Html.Label(service.Name)
                        </td>

                        <td style="padding:15px 15px">
                            @Html.Label(service.Price.ToString()) ден.
                        </td>


                        @if (service.StringsAsStrings != null)
                        {
                            flag = true;
                            foreach (var img in service.StringsAsStrings.Split(','))
                            {
                                if (img != "")
                                {
                                    images.Add(img);
                                }
                            }
                        }


                        <td style="padding:15px 15px;">
                            @if (User.IsInRole("Client"))
                            {

                                using (Html.BeginForm("MakeReservation", "Reservations", FormMethod.Get))
                                {
                                    @Html.Hidden("ServiceId", service.Id)
                                    @Html.HiddenFor(m => m.SalonId)
                                    <button class="btn default" type="submit" stylresource="margin:45px 0 30px 0">
                                        <span>РЕЗЕРВИРАЈ</span>
                                    </button>
                                }

                            }

                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    @if (flag)
    {
        <div class="col-md-4">
            <div style="padding:15px 15px; padding-left:79%">
                <button class="btn default links" onclick="openModal();currentSlide(1)">ПРЕГЛЕДАЈ ГАЛЕРИЈА</button><br />
                <br />
                <br />
                <!-- The Modal/Lightbox -->
                <div id="myModal" class="modal">
                    <div style="float:right;padding-right:30px">
                        <p style="color:coral;font-size:50px;cursor:pointer" onclick="closeModal()">&times;</p>
                    </div>
                    <div class="modal-content" style="clear:both">
                        @{
                            foreach (var img in images)
                            {
                                if (img != "")
                                {
                                    index++;
                                    <div class="mySlides">
                                        <div class="numbertext" style="color:coral">@index</div>
                                        <img src="~/UploadedFiles/@img" style="display:block;height:500px;margin-left:auto;margin-right:auto">
                                    </div>
                                }
                            }

                        }
                        <!-- Next/previous controls -->
                        <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
                        <a class="next" onclick="plusSlides(1)">&#10095;</a>
                    </div>
                </div>
            </div>
            <br />
            <br />
            <br />
        </div>
    }
                            <br/>
    <br />
    <br />
    <div class="col-md-4" style="padding-left:30%">
        @if (User.IsInRole("Salon") && User.Identity.Name.Equals(Model.Salon.User.Email))
        {
            <div class="btn default links">
                @Html.ActionLink("ПРЕГЛЕДАЈ РЕЗЕРВАЦИИ", "Index", "Reservations", new { Id = Model.SalonId }, null)
            </div>
        }
    </div>
    <br />
    <br />
    <br />
</div>

        @if (User.IsInRole("Salon") && User.Identity.Name.Equals(Model.Salon.User.Email))
        {
            <h5>
                <i style="margin-left:12%">
                    @Html.ActionLink("Ажурирај профил", "Edit", new { id = Model.Salon.UserId })
                </i>
                <i style="float:right;margin-right:12%">
                    @Html.ActionLink("Ажурирај податоци за најава", "Index", "Manage", routeValues: null, htmlAttributes: new { title = "Уреди" })
                </i>
            </h5>
        }


@section Scripts{
    <script type="text/javascript">

        $(document).ready(function () {
            var votes = parseInt(@ViewBag.votes);
            if (votes == 0) {
                $("#toVote").css("display", "block");
            } else {
                $("#voted").css("display", "block");
            }
        });

    </script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>

    <@*script type="text/javascript" src="../src/rating.js"></script>
    <link rel="*@stylesheet" href="../src/rating.css" type="text/css" media="screen" title="Rating CSS">

        <script type="text/javascript">
                $(function () {
                    $("img.rating").mouseover(function () {
                        //full
                        giveRating($(this), "589px-Star_empty.svg.png"); // greshno ime samo ama okay dzvezda
                        $(this).css("cursor", "pointer");
                    });

                    $("img.rating").mouseout(function () {
                        // empty
                        giveRating($(this), "1024px-Empty_Star.svg.png");
                        refilRating($(this));
                    });
                    $("img.rating").click(function (e) {
                        // $("img.rating").unbind("mouseout mouseover click");
                        $(this).css('color', 'red');
                        // alert(e.currentTarget + ' was clicked!');
                        // call ajax methods to update database
                        var salonId = "@ViewBag.salon";
                        var url = "/Salons/PostRating?rating=" + parseInt($(this).attr("id")) + "&salonId=";
                        var url = url.concat(@Html.Raw(Json.Encode(Model.SalonId)));
 //                       var url = "/Salons/PostRating";
                        $.post(url, null, function (data) {
                            $(e.currentTarget).closest('div.tagg').find('div.result').text(data).css('color', 'red') // $("#result").text(data);
                            location.reload();
                        });
                    });
                });


                function giveRating(img, image) {
                    img.attr("src", "/UploadedFiles/stars/" + image).prevAll("img.rating").attr("src", "/UploadedFiles/stars/" + image);
                }
                function refilRating(img1)
                {
                    var rt = $(img1).closest('div.tagg').find("span.avr").text();
                    var img = $(img1).closest('div.tagg').find("img[id='" + parseInt(rt) + "']");
                    img.attr("src", "~/UploadedFiles/stars/589px-Star_empty.svg.png").prevAll("img.rating").attr("src", "~/UploadedFiles/stars/589px-Star_empty.svg.png");
                }
        </script>
        <script src="~/Scripts/gallery.js" type="text/javascript">
        </script>
        <link href="@Url.Content("~/Content/css-stilovi/gallery.css")" rel="stylesheet" type="text/css" />
}


